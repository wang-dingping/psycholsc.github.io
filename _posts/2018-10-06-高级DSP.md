---
layout: post
title:  "高级DSP"
excerpt: "Advanced Digital Signal Processing"
date:   2018-10-06 21:54:54 +0000
categories: Notes
comments: true
---

<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
这就是传说中的高级DSP么

**注意，以下所有内容都是考试要点。**

推荐参考资料

[1].[胡广书.数字信号处理导论.清华大学出版社.2005](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/15811735-胡广书.pdf)



## 高级DSP课程简介

可能会出现的基础内容涉及**信号、噪声、信号空间、相关函数、采样、DFT**等。

可能涉及到的进阶内容包括**采样率转换、采样率转换过程中的数字滤波器设计**。

可能会出现一点**小波变换**。

## 概论

（没想到有一天我还要再看一遍这些**S.H.I.T.**

信号、信息和消息是三个不同的概念。信息是消息的载体，而信号是信息的表现形式。信号有很多表现形式，自然界中的声音、图像（光）、震动等都属于一种信号，而人类也会人为产生一些信号，例如雷达信号、通讯信号等。

信号是一种与物理过程联系紧密的量，可以使用数学来描述与分析。DSP就是研究信号处理的学科。我们可以利用具体的数学表达式将信号描述成一个用若干自变量描述的函数或序列。我们常说信号分为**模拟和数字信号**，其中模拟信号（Analog Signal）就是连续信号，特征是信号在任意指定时间可以是任意值；而数字信号是一种时间（自变量）和信号（因变量）都是离散的信号。但是此处我们做一个更加广泛的分类，即

**模拟信号**：时间幅度均为连续

**连续时间信号**：时间连续，幅度连续或离散

**离散时间信号**：时间离散，幅度连续或离散

**数字信号**：时间和幅度均为离散值

其中既不属于模拟信号又不属于数字信号的的其他信号也在其中。很多教材中都会使用**离散信号**表示**数字信号**，这种说法是没有问题的。

由于数字信号的一些不可替代的优势，目前已经很少有地方还在使用全模拟信号的通信。对于模拟信号，往往也会采用数字处理方法。数字信号的优势有

1. **抗干扰强，无噪声积累**。经过一级处理后的数字信号不会积累噪声，我们可以通过判决再生的手段，将信号的噪声抑制掉，因为数字信号往往取离散值。而模拟系统的噪声是积累的，经过一级处理后，信号中的噪声就会被放大，设备的噪声也会叠加在信号中。
2. **方便加密**。离散值便于处理，这就不需要过多介绍了。
3. **便于设备集成化微型化**。数字信号处理时，大部分都采用数字电路进行处理，而数字电路的集成规模已经相当大了，体积小功率低。
4. **便于构成通信网**。标准化数字传输。不同信号之间转换方便。

而由于使用计算机处理或其他数字处理方式时，信号往往需要经过采样后送入每一个处理单元中进行处理，目前的设备并不能较为方便地处理连续信号，而当信号数字化后处理变得方便的多，因此目前绝大多数信号已经采用数字处理。而对于模拟信号，常常就采用采样量化的方式转化为数字信号，经过数字处理后，使用ADC转换为模拟信号。

在处理时，如果不加特殊说明，基本上都是对电信号的处理。另外信号是包括实信号与复信号的，物理上可以采集并处理的信号基本都是实信号，但是基于数字模型基础上的信号，很多都是复信号。

说到数字信号处理，其含义是利用计算机或专用处理设备（例如可编程设备或不可编程的门电路阵列），用数学方法对信号进行采集、变换、综合、估值与识别等加工处理，从而达成提取和便于应用的目的。因此我们说，数字信号处理的任务就是，从信号中提取我们需要的信息，并将其用于实际。例如一个简单的心电监护仪，主要通过收集人的身体信号，然后对这些信号进行处理，获取心电波形。这类仪器中往往是含有CPU的，能实时显示和存储病人的心电波形。实际上仅仅是心电信号的处理都十分困难，人体的一点移动都会造成采集地各路信号发生变化，而人体还存在较为明显的肌电噪声等其他噪声，设备还有50Hz工频干扰，因此心电信号的处理实际上较为困难，其中涉及许多处理的知识。但总体来说，数字信号处理一般包括**降噪（去噪）、特征检测、应用于实际**三个方面。

数字信号处理可以追溯到17世纪，当时已经采用了有限差分、数值积分、插值等方法，虽然与现代DSP还有很多不同，但是已经有了雏形。进入20世纪后，由于电子计算机等设备的出现，信号处理逐渐发展，成为了一个独立的学科。一般认为，1965年FFT的出现是数字信号处理这个学科的新开端，其中包含**经典数字信号处理、统计数字信号处理 和 现代数字信号处理**三大部分。

**经典数字信号处理**主要包括

1. 离散信号和离散系统分析（系统的描述、单位抽样响应、转移函数、频率特性等）
2. Z变换、DFT、FFT等信号域的变换
3. FIR、IIR数字滤波器设计。

**统计数字信号处理**主要包括

1. 随机信号描述，自相关函数估计，AR、MA、ARMA、PRONY等各种信号模型
2. 经典功率谱估计和现代功率谱估计
3. 维纳滤波和自适应滤波

**现代数字信号处理**是指非平稳信号的分析和处理理论

1. 时频联合分析
2. 滤波器组
3. 小波变换

*短期内还是不会接触到这些内容的。*

数字信号处理的实现主要是**软件实现**和**硬件实现**。软件实现时，我们常采用MATLAB等类似的软件包，而硬件实现时，往往采用特殊的处理芯片，或使用特定IC构成满足数字信号处理任务要求的系统。

## 离散时间信号

### 典型离散信号

$$f_s=\frac{1}{T_s}$$，其中$$f_s$$是采样频率。我们常用$$\omega=2\pi \frac{f}{f_s}$$来表示。



1. 单位抽样信号，常写作$$\delta(n)$$
2. 脉冲串序列，$$p(n)=\sum\limits_{k=-\infty}^{\infty}\delta(n-k)$$
3. 正弦信号，$$sin(n)=sin(t)\mid_{t=nT_s}=Asin(2\pi n\frac{f}{f_s}+\phi)=Asin(\omega n+\phi)$$。
4. 复正弦信号，$$e^{j\omega n}=cos(\omega n)+jsin(\omega n)$$
5. 单位阶跃信号，常写作$$u(n)$$。$$u(n)=\sum\limits_{k=-\infty}^{n}\delta(k)$$，$$\delta(n)=u(n)-u(n-1)$$
6. 指数信号，$$x(n)=a^{\mid n \mid}, \mid a \mid<1$$



### 离散信号的运算

1. 延迟（位移）。$$y_1(n)=x(n-k)$$，代表信号序列**右**移$$k$$个单位。但是$$n-k$$代表的是过去的时刻。反之亦然。
2. $$x(k)=x(n)\delta(n-k)$$，$$x(n)=\sum\limits_{k=-\infty}^{\infty}x(k)\delta(n-k)$$
3. 加减乘除发生在对应位置的信号。要求两个序列长度相同，时间范围相同。
4. 尺度变化。$$y(t)=x(\frac{x}{a})$$，若$$a>1$$，信号扩展，反之信号压缩。
5. 对于给定$$x(n)$$，$$y(n)=x(Mn)$$，称为$$M$$倍抽取，采样频率变为$$f_s/M$$；$$y(n)=x(n/L)$$，称为$$L$$倍插值，采样频率变为$$Lf_s$$。
6. 信号的分解。$$x=\sum\limits_{n=1}^N \alpha_n \phi_n$$，这就是一个分解，称$$\alpha_i$$为分解系数，$$\phi_i$$为基向量。如果$$\phi_i$$是一组两两正交的向量，该式称为正交展开（正交分解），分解系数即为信号在各个基向量上的投影。
7. 变换。信号的变换是分解的逆过程，相当于给定一个$$x$$信号和$$\phi_i$$的条件下求解分解系数。变换是将信号由一个域映射到另一个域内，常见的有傅里叶变换，希尔伯特变换，小波变换等。



### 离散信号分类

#### 按周期

$$x(n)=x(n+T)$$对于任取$$n$$成立。

#### 按确知

确定信号，在任意时刻的值能被精确确定。

随机信号，在任意时刻的取值是随机的。

随机信号往往都是功率信号，分为平稳和不平稳。平稳信号分为各态历经和非各态历经。平稳表示其统计性质不随时间改变（严平稳），各态历经表示各个样本函数都经历了随机过程的各种可能状态。

#### 按能量功率

对信号求能量的方法为

$$E=\int\limits_{-\infty}^\infty|x(t)|^2dt$$

或

$$E=\sum\limits_{n=-\infty}^\infty|x(t)|^2$$

能量信号的标志是$$E<\infty$$如果信号长度有限，一般就是能量信号。

而功率的求法为

$$p=\lim\limits_{T \to \infty}\frac{1}{2T}\int\limits_{-T}^T|x(t)|^2dt$$

或

$$p=\lim\limits_{N \to \infty}\frac{1}{2N+1}\sum\limits_{-N}^N|x(t)|^2$$

当$$p$$有限的时候，该信号就被称为功率信号。

时间无限的信号一般是功率信号，有限区间内的确定信号一般是能量信号。

#### 按维度

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/ADSP.jpg)

### 噪声

噪声时信号中无用的成分，生活中接触到的噪声有收音机的杂音、电视上的雪花点等。其来源很多，例如家用的50Hz交流电的干扰，热噪声（主要来源），量化噪声，其他设备的宽频干扰等。所有信号都会受到噪声的影响，在接收机端收到的噪声较为明显。一般我们认为，当信号比噪声强度大得多的时候，信号处理就不会受到显著影响。

**白噪声**：任意两个时刻的取值不相关（自相关函数为$$\delta$$函数），频谱为一条直线，在信号分析与处理的过程中是最常用的噪声模型。

**色噪声**：相对于**白**，只要噪声频谱不平坦就被认为是色噪声。

**脉冲噪声**：段时间间隔内出现尖脉冲。

我们常说的**高斯白噪声**，其瞬时值的统计规律服从正态分布，而频谱又是一条直线（白）。热噪声就是高斯白噪声。

噪声一般还分为加性和乘性噪声。

### 信号空间

**赋范线性空间**。首先说啥叫“赋范线性空间”，之前的文章里面已经讲过什么是范数，线性代数中也简单介绍过线性空间的概念。我们假设信号$$x$$是线性空间$$X$$中的一个元素，记作$$x\in X$$，这里线性空间可以理解为向量空间。我们对信号重新定义范数如下

$$||x||_\infty =max\{ |x(t)|,-\infty<t<\infty\}$$

$$||x||_\infty =max\{ |x(n)|,-\infty<n<\infty\}$$

$$||x||_1 =\int _{-\infty}^{\infty}|x(t)|dt=\sum\limits_{n=-\infty}^{\infty}|x(n)|$$

$$||x||_2 =[\int _{-\infty}^{\infty}|x(t)|^2dt]^{1/2}=[\sum\limits_{n=-\infty}^{\infty}|x(n)|^2]^{1/2}$$

这些范数的计算方式还是相同的，只是因此被赋予了特殊的含义。例如无穷范数代表信号的最大幅度，1范数代表了信号的绝对和，2范数代表了信号的能量。我们可以针对每一类范数定义一个信号空间，例如

$$L_\infty ,l_\infty=\{ x:||x||_\infty <\infty\}$$

该空间代表最大幅度有界信号的集合。如果把范数换成2范数，则代表能量有限信号集合。这时我们说这个信号是绝对平方可积的。

我们说这三种信号空间都是线性空间，那么定义了范数的线性空间就被叫做赋范线性空间。范数中有一些特殊的性质，例如

$$||x+y||\leq||x||+||y||$$

**度量空间**：任取两个信号$$x,y$$，定义其距离

$$d(x,y)=||x-y||_2=[\int _{-\infty}^{\infty}|x(t)-y(t)|^2dt]^{1/2}$$

这个距离是一个有限值，且$$d(x,y)==d(y,x)$$，并且遵循三角原则$$d(x,y)\leq d(x,z)+d(z,y)$$。

度量空间实际上就是定义了距离的空间。

**内积空间**：仍设$$x,y$$是线性空间$$X$$中的元素，如果对任意的$$x,y\in X$$都有一个复数$$<x,y>$$与其对应，并且满足

1. $$<x,y>==<y,x>^*$$
2. $$<\alpha x+\beta y,z>==\alpha <x,z>+\beta <y,z>$$
3. $$<x,x> \geq 0$$

我们称$$X$$为内积空间，复数$$<x,y>$$即为内积，且满足

$$<x,y>==\int_{-\infty}^\infty x(t)y^*(t)dt$$

或

$$<x,y>==\sum\limits_{n=-\infty}^{\infty}x(n)y^*(n)$$

如果两个信号内积为0，我们说这两个信号是正交的。



**希尔伯特空间**是一个完备的内积空间

这部分太抽象了还是不写了。



**许瓦兹不等式**

对于信号空间中的信号，我们可以证明

$$|<x,y>|^2 \leq <x,x>·<y,y>$$

即两个信号之间的内积小于等于各自内积的乘积。可以写成积分或求和的形式。

### 确定信号的相关函数

**要注意这个和我们学习的随机信号分析课程讲的不一样**

定义一个**相关系数**

$$\rho_{xy}=\frac{\sum\limits_{n=0}^\infty x(n)y(n)}{[\sum\limits_{n=0}^\infty x^2(n)\sum\limits_{n=0}^\infty y^2(n)]^{1/2}}$$

其分母为两信号能量乘积的开方，分子是两个信号对应项的乘积。根据许瓦兹不等式，显然这个系数是小于等于1的。

当两个信号完全相等的时候，这个结果取得1；当两个信号完全不相关的时候，该结果就是0。由于$$\rho$$的取值范围是0到1，因此也叫作归一化的相关系数。

但是相关系数只能评价两个信号的相似程度，却不能评价两个信号在不同位置的相似程度。对于两个正弦信号来说，只要将另一个信号平移$$\pi/2$$，相关系数立即从1降至0。

因此我们定义相关函数

$$R_{xy}(m)=\sum\limits_{n=-\infty}^\infty x(n)y(n+m)$$

根据x和y位置不同我们写作$$R_{xy}$$和$$R_{yx}$$，两者的关系是

$$R_{xy}(m)==R_{yx}(-m)$$

这个相关我们称作互相关，对于两个信号都为同一信号的情况，我们称其为自相关。自相关函数反映了信号和其自身延迟的相似程度，记为$$R_X$$等。

相关函数的性质有

$$R_X(0)=\sum\limits_{n=-\infty}^\infty x^2(n)=E_X$$

（如果这个信号不是一个能量信号，该结果往往为无穷大）

$$R_X(\infty)=m_X$$

DSP研究的是离散信号，对于离散信号，相关函数定义为

$$R_{xy}(m)=\lim\limits_{N \to \infty}\frac{1}{2N+1}\sum\limits_{n=-N}^N x(n)y(n+m)$$

自相关同理。特别的，自相关函数的周期和原信号周期相同（如果原信号是周期信号）。而且对于周期函数，我们计算时要更加简单

$$R_{X}(m)=\frac{1}{N}\sum\limits_{n=0}^{N-1} x(n)x(n+m)$$

对于复信号的自相关，我们常常（习惯）取**第一个**x为其共轭值。如果不做说明，我们认为实际信号都是实信号。

自相关函数还有一些性质，例如

1. 如果x是一个实信号，那么其自相关函数是实偶函数，如果x是一个复信号，那么相关函数$$R_X(m)=R_X^*(-m)$$
2. 自相关函数在0处取得最大值，这时候代表的是信号的能量。
3. 对于能量信号，当$$m \to \infty$$时认为自相关函数的值为。这与我们在随机信号中学习的不同，因为随机信号往往是一个功率信号。
4. 互相关函数不是偶函数，但是$$R_{xy}(m)==R_{yx}(-m)$$
5. 互相关函数在0处取得最大值为$$\sqrt{E_XE_Y}$$
6. 两个能量信号的互相关函数在$$m \to \infty$$为0

相关函数往往应用在噪声中信号检测、隐含周期性检测等领域。

### 连续时间信号FT

傅里叶发现任意一个周期信号都可以分解为无穷多个不同频率的正弦信号和，这个就叫做傅里叶级数，高等数学中有详细证明。

在电信人心中最完美的信号就是弦振荡信号，因为它幅度频率相位都是完全确定的，而且有许多数学上的性质，各自充分或必要地证明着这就是最完美的信号（于是我决定叫他“卡兹~~sama~~”信号（并不是。

弦信号有正交性，这也是我们选择它为基向量的原因（不理解这句话的可以往回翻翻）

#### 1. 连续周期信号

假设$$x(t)$$是一个周期为T的周期信号（且一个周期内能量是有限的），对于周期信号

$$x(t)=\sum\limits_{k=-\infty}^\infty X(k\Omega_0)e^{jk\Omega_0 t}$$

这个本质上是$$x(t)$$的一个分解，用于分解的基函数（向量）是复正弦。

这个系数我们可以表示为

$$X(k\Omega_0)=\frac{1}{T}\int_{-T/2}^{T/2}x(t)e^{-jk\Omega_0 t}dt$$

这个可以通过正弦的正交性得到。

傅里叶变换实际上是将信号$$x(t)$$和一组不同频率的复正弦做**内积**，这一组复正弦就是变换的基向量。傅里叶系数或变换可以看做是信号$$x(t)$$在基向量上的投影。

这个变换结果的含义是第k次谐波的系数，显而易见结果是离散的，频谱上的间隔为$$\Omega_0$$

周期矩形信号（周期为T，开通时间为$$\tau$$，幅值为A）的傅里叶级数是

$$X(k\Omega_0)=\frac{A\tau}{T}\frac{sin(k\pi f_0\tau)}{k\pi f_0\tau}$$

结果是一个Sinc函数型的。

#### 2. 连续非周期信号

如果连续非周期信号是一个能量有限的信号，那么FT就是

$$X(j\Omega)=\int_{-\infty}^{\infty} x(t)e^{-j\Omega t}dt$$

$$x(t)=\frac{1}{2\pi}\int_{-\infty}^{\infty} X(j\Omega)e^{j\Omega t}d\Omega$$

$$\Omega=2\pi f$$是角频率，单位是$$rad/s$$此时的变换结果是一个连续函数，称为信号x的频谱密度函数。

同样对于上面的方波信号，如果只有一个周期的话，就是一个门函数，其变换结果是

$$A\tau \frac{sin(\Omega\tau/2)}{\Omega\tau/2}$$

如果不是能量有限的，我们就不能直接进行FT。

---



对于第一种情况，我们得到的频谱是以$$\Omega_0$$为间隔离散的，而去除周期后我们发现频谱是连续的。

实际上两者存在联系，假设我们将连续信号的频率减小，即增大周期直到无穷大，频谱间隔$$\Omega_0$$就会降低至无穷小，极限情况就是连续谱。

**帕斯瓦尔定律**：信号在时域和频域计算的功率是等同的（功率也是）。

对于周期信号，如果要实现傅里叶变换，可以引入奇异函数。

其主要方法是

$$X(j\Omega)=\int_{-\infty}^{\infty} x(t)e^{-j\Omega t}dt  = \int_{-\infty}^{\infty} [\sum\limits_{k=-\infty}^\infty X(k\Omega_0)e^{jk\Omega_0 t}]e^{-j\Omega t}dt$$

提出求和项并让复频率项进行积分运算，根据

$$\int_{-\infty}^{\infty}e^{\pm jxy}dx=2\pi\delta(y)$$

得到变换结果

$$X(j\Omega)=2\pi \sum\limits_{k=-\infty}^\infty X(k\Omega_0)\delta(\Omega-k\Omega_0) $$

即周期信号的FT是由频率轴上间距其$$\Omega_0$$的冲激序列组成，强度为傅里叶系数乘$$2\pi$$。仍是离散频谱，周期信号的频谱相当于在无穷小的频率范围内取得一个无穷大的频谱密度。

这一段记住时域周期连续频域离散非周期；时域连续非周期频域连续非周期。

### 离散时间信号FT（DTFT）

就是离散时间傅里叶变换。时域信号是一个离散非周期信号，频域上得到连续频谱，但是是周期的。

$$X(e^{j\omega})=\sum\limits_{n=-\infty}^{\infty} x(n)e^{-j\omega n}$$

$$x(n)=\frac{1}{2\pi}\int_{-\pi}^{\pi} X(e^{j\omega})e^{j\omega n}d\omega$$

此处的$$\omega$$是数字频率，单位是$$rad$$，变换结果的频谱是一个连续函数，周期为$$2\pi$$。我们常见的z变换就是用$$z=e^{j\omega}$$进行代换。

现在我们已经有了三种傅里叶变换，应当还有一种离散到离散的对应关系。

> DFS：难道是我？
>
> DFT：没错正是在下

给个图理解一下

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/4FT.jpg)

#### 截断信号对DTFT的影响

以上DTFT都假定n为无穷，但是实际上要处理的信号一定是有限长度的（处理数字信号不可能处理无限长信号）。所以我们需要对信号进行截断处理。将无限长信号截断就相当于使用矩形窗乘信号。实际上截断就是加窗，直接截断我们称为矩形窗。对于矩形窗，实际上就是有效区域连续N个点全为1，无效区域全为0。

对矩形窗做DTFT得到

$$D(e^{j\omega})=e^{-j(N-1)\omega /2}\frac{sin(\omega N/2)}{sin(\omega /2)}$$

这个函数的最大值在$$\omega=0$$的时候取得为N，在$$\omega=2\pi k/N$$时都为0

相位响应是线性的，主瓣宽度$$B=4\pi /N$$，旁瓣衰减为-13.46dB。当矩形宽度N趋近无穷大时，该响应会趋近于$$\delta(t)$$。这一段还是有图看着舒服，有机会补上图。

数字域的Sinc函数就是sin/sin的形式。结果可以自行绘制查看，就是一个sinc函数的形状。根据频域卷积定理，时域乘法相当于频域的卷积，则相当于在频域上进行卷积sinc函数。

由于矩形窗在频域上是sinc函数的形式，因此会出现频率分辨能力的问题。假设信号中有两个频率相近的分量，那么就有可能出现卷积结果只有一个峰值的情况，例如

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/ADSPI.jpg)

显然，当我的矩形窗宽度越小，频率分辨能力就越差。我们可以理解为，截断部分保留的信息减少，从而导致频率分量不易辨别。

这个现象被称为频谱泄漏，泄漏往往会模糊原来真正的谱的形状，窗函数过大的旁瓣甚至会产生假的谱峰，从而导致错误的结果。

然而，所有有限长的信号都要看做一个无限长信号的和一个矩形窗相乘的结果，从而在频域发生畸变（与矩形窗以及频率分辨率（采样频率）有关）。

在最大峰值两边的第一个过零点之间的距离被称为主瓣宽度，我们希望主瓣宽度越小越好；相应的我们希望旁瓣的幅度越小越好，这样就能抑制泄漏。实际上矩形窗的主瓣宽度相当小，从而频率定位性最强，但是其旁瓣抑制过小，在实际应用中是一个很不好的窗函数。要注意，这两个参数不可能同时减小。

截短对信号产生的影响主要是降低频率分辨率和频谱泄漏。主瓣对信号产生平滑，所以频率分辨率降低。矩形窗主瓣较窄，产生的影响较小。而旁瓣就会引起频谱泄漏，可以看出矩形窗的频谱泄漏是最明显的，因为其旁瓣抑制最小。

### 连续时间信号抽样

有一种元件叫模数转换器，可以将输入的模拟信号进行采样量化，从而输出数字信号。这时数字信号处理过程中的一种必要器件。那么问题来了，~~挖掘机技术哪家强~~数字化后的离散信号究竟能否包含模拟信号中的全部信息？二者的FT结果是什么关系？能否从数字信号中恢复模拟信号（的信息）？

首先是采样定理的问题。根据奈奎斯特采样定理，只要$$f_s \geq 2f_{max}$$，我们就能无失真地获取模拟信号中的信息。这个详细内容应该不用，那考虑到我有读者还是说一下吧（假装有人看嘤嘤嘤

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/ADSPorigin.jpg)

这个是我们的原始信号序列，其中左边是时域信号，右边是频域信号。

我们用来采样的是冲激串

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/samplingseries.jpg)

冲激串在时域是冲激，做FT后还是冲激。时域采样是乘法，在频域上就是卷积。卷积结果如下

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/conv.jpg)

注意这个卷积，如果冲激串频率高，那么频域间隔就会很大，卷积后的结果就不容易出现混叠。如图没有出现混叠，因此我们认为信息没有丢失。要恢复信息也很简单，采用低通滤波器就好了。最后结果还要做一个归一化这里不再继续做了。



上面还有一个问题，就是采样前后FT的关系。关系就是

连续信号FT得到$$X(j\Omega)$$，对连续信号进行抽样，表现在频域上，频谱出现周期延拓。对时域做归一化处理，频谱坐标归一就得到了$$X(e^{j\omega})$$

BTW，实际上采样定理对窄带信号操作的时候，并不需要满足最大频率的两倍，而是与带宽满足一定关系就好。

数字处理后要恢复原来的信号，实际上也很简单，理论上有一个理想低通滤波器，只保留需要的低频内容即可。只要满足抽样定理，由无穷多的加权移位sinc函数和就可以重建原信号。

假设理想低通滤波器频率响应如图（中）

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/recover.jpg)

左信号与 中间的滤波器做乘积就得到了右边的频谱，即恢复了原信号。这个过程相当于时域上卷积sinc函数，相当于在任意t时间上按卷积插值。

（公式需要背吗好复杂啊）

理论上bb了这么多，带入弦函数试一试，假设正弦函数$$x(t)=Asin(2\pi f_0 t+\phi)$$，那么它的频谱是在$$\pm f_0$$处的$$\delta$$函数。按照抽样定理，我们取$$f_s=2f_0$$进行抽样，那么在一个周期内只能取得两个点。实际上我们并不知道这两个点来自于什么信号，而且这两个点的值还随着相位在变化。如果这时候取样点正好是0，我们实际上没有得到这个信号的任何信息；如果取样点正好是最高值点，我们也不知道这两个点来自于谁——方波、三角波或其他波都会出现这样的采样结果。虽然我们很明确，对这个结果加一个低通滤波，一定会得到一个正弦函数。

而对于正弦函数，由于其频谱是一个冲激，因此在截断后一定会出现sinc状频谱，中心频率处的能量不可避免的分散到其他位置去了。

对于未知正弦信号，应先使用示波器简单观测一下信号，然后采用三倍及以上的倍数对信号进行采样。在做FFT的时候，抽样频率建议采取信号频率的四倍以上，即每周期四点。截断数据时，一般也要求截断信号包含整数个周期（减少泄漏）。

### 离散时间周期信号的傅里叶级数

当需要处理的的信号是一个离散周期信号的时候，根据我们前面介绍的规律，频谱应当是离散（时域周期）周期（时域离散）的。但是这时候的信号是功率信号，并不能直接做DTFT。

首先对周期为T的信号做傅里叶级数展开，这个是允许的，只要一个周期内的能量有限就可以。我们将得到

$$x(t)=\sum\limits_{k=-\infty}^{\infty}X(k\Omega_0)e^{jk\Omega_0 t}$$

这个展开是离散非周期的。现在我们对时域信号做抽样，假设抽样频率为$$f_s$$，时间间隔即为$$T_s$$，得到结果为

$$x(nT_s)=\sum\limits_{k}X(k\Omega_0)e^{j\frac{2\pi}{N} nk}$$

($$\Omega_0=2\pi/T=2\pi/NT_0$$)

这样我们就得到了一个离散周期的结果，周期为$$\Omega_s$$，而正因为结果是周期的，所以求和要在一个周期内进行，上下限就此抹去。时域进行了N点取样，基波频率为$$\Omega_0$$，此时$$\Omega_s=2\pi/T_s=2\pi N/T_s=N\Omega_s$$

因此说频谱一个周期内有N个点。

### DFT

以上求和过程与$$\Omega_0$$不再相关，因此可以将结果写成$$X(k)$$，其中k的取值是正负无穷（周期信号）。我们称其为DFS，离散周期序列的傅里叶级数。如果我们忽略二者的周期性，只取其中的一个周期用于分析，我们就会得到DFT。这个我们叫做离散傅里叶变换。

DFT实际上是与DFS相同的，不同点就在于只有一个周期。对于数字信号来说还是单周期易于分析，因此DFT也更广泛应用于DSP行业。

重新写一遍DFT的定义

$$x(n)=\frac{1}{N}\sum\limits_{n=0}^{N-1}X(k)e^{j\frac{2\pi}{N}nk}$$

$$X(k)=\sum\limits_{n=0}^{N-1}x(n)e^{-j\frac{2\pi}{N}nk}$$

并说明，DFT并不是一种新的变换，只是DFS做了一个周期的截断，而对于有限长为N的非周期序列，在做DFT时我们都会假定这一部分是整个序列的一个周期。对于无限长的序列，我们就要对序列进行加窗，截断为N点，并认为这N个点是某一个周期序列的一个周期。

对于时间有限的信号我们并不能得到频域带限的信号，但是我们在进行DFT时会假定这个信号是一个周期序列的一个周期，因此本质上是对一个无限长信号进行变换，因此结果频域是带限的。

但也正是这个原因，我们本来的信号并不是周期信号，因此在反变换回来的时候会出现时域混叠，因此说$$x(n)$$（反变换结果）是原时域信号的一个近似（而非采样）。

#### DFT的正交性

变换时为表达方便，我们常将相位写作

$$e^{-j\frac{2\pi}{N}nk}=W_N^{nk}$$

这样可以将求和的结果写成矩阵相乘的形式，

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/DFT.png)

这个矩阵是一个正交矩阵，满足$$W^*_NW_N==NI$$，所以我们称DFT为正交变换。常常也写作

$$X_N=W_Nx_N$$

#### 循环卷积

循环卷积又叫做圆周卷积，对于两个N点的序列，卷积结果仍然是N点序列。实际上就是两个序列的错位相乘结果的求和，按顺序写成N点序列。注意二者的方向始终是相反的，例如

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/DFT2.png)

循环卷积是对应于DFT的卷积，两个序列的DFT的乘积就是两个序列的循环卷积，反之也成立。

当然并不是说DFT不能计算线性卷积，如果事先对两个序列进行补零操作（对于长度为N和M的序列，就应该补零到N+M-1，即线性卷积后的序列长度），然后再对DFT相乘求反变换，就能得到两个序列的线性卷积。

### FAQ

#### 1. 频率分辨率以及DFT参数的选择

频率分辨率有两种定义，一般在教学时讲的是仪器分辨频率间隔的物理极限。

**第一种定义**是，某一种算法将原信号中两个靠的很近的谱峰保持分开的能力，用来检验算法的好坏。在FT中假设信号长度为T，假设视为无穷长度信号与长度为T的矩形窗进行相乘，则$$\Delta f$$可以定义为$$1/T \ Hz$$。

这个变换结果就是原信号频谱对sinc函数做卷积。假设原信号中存在两个谱峰，想要辨别这两个谱峰，就需要

$$4\pi /T < abs(\Omega_1-\Omega_2)$$

如果我们采用DTFT的方法，假设抽样间隔为$$T_s$$，抽样点数就是$$N=T/T_s $$。想要分辨两个谱峰，就需要

$$4\pi /N < abs(\omega_1-\omega_2)$$

这个频率是归一化的频率。

此时频率分辨率定义为

$$\Delta f=f_s/N$$

如果采用其他窗函数，由于主瓣宽度的不同，频率分辨率也会产生变化，与其他窗函数相比，矩形窗对频率分辨的能力是最强的了。在有些文献中，DTFT定义的分辨率有时被称作**物理分辨率**。

对于一个仪器设备来说，如果要提高设备的采样频率，受限于物理极限，它的采样点数也会增加；相应的也是相同道理。因此我们说频率分辨率不是容易轻易改变的。

**第二种定义**是在DFT中定义的。相比前面在DTFT中的定义，DFT中用相同的表达式定义$$\Delta f=f_s/N$$为计算分辨率，是频率轴上最小的频率间隔。当我们对一个信号观测不完全时，可以通过补零的方式将信号看的更加详尽（增加了N），但是对于频率分辨率来说是不会提升的。

DFT中N指的是序列的长度，但是DTFT中的N指的是有效序列长度，与T有关，分辨率与窗函数的主瓣宽度有关。

总结起来就是，在数据长度一定的条件下，采用不同的窗函数将在频率分辨率与频谱泄漏之间取舍。频率分辨率取决于信号长度和频谱分析的算法。除了频率分辨率还有时间分辨率的问题，他们也存在相互制约关系，此处不展开简介。

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/ADSPeg.png)

我们可以自己使用MATLAB做一个测试。

一般的我们认为，首先选取一个高于最高频率二倍的采样频率，并根据频率分辨率要求设置信号长度N，并且尽量是2的整数次幂。此时根据N和采样频率我们还可以确定模拟信号的频率。

#### 2. 补零问题

补零不能提高频率分辨率，因为信号的有效长度就那么长，补零没有帮助。另外2的整数次幂有利于FFT的运算，数据过短时，补零可以对频域产生插值效果，有利于辨认频谱本身的形状。

#### 本章考点

1. 四种傅里叶变换的概念、区别及联系。
2. 截短信号的影响频率分辨率降低与频谱泄漏
3. 抽样定理（正弦抽样）
4. DFT导出，DFT与FT、DTFT的关系
5. 圆周卷积和线性卷积
6. FAQs

### 变速率信号处理

线性时不变系统始终工作在相同信号速率的条件下，即系统输入、输出以及中间环节的信号采样频率相同，但是实际上在不同任务下采用不同的采样速率可能对该任务更合适，因此需要采样速率转换的技术。转换的原则就是不能使信号失真。

采样速率转换技术是软件无线电的理论基础。据说软件无线电技术前一阵火了一段时间，后来又销声匿迹掉了。由软件平台定义通信协议，而不依赖于专用硬件（想必性能应该很差吧）

采样率转换技术常用在宽窄带联合处理的系统中，用意是降低计算复杂度，降低传输速率，并减少存储量。在采样定理满足的前提下，实际上最容易想到的方式是将某一抽样信号进行DA转换，并经过另一个AD转换变成另一种频率。这方法有脑子的人都会觉得不行。槽点太多吐不过来了。

#### 下采样（降速率）

下采样实际上就是将原信号的速率降低为原始速率的1/M。原信号每隔M-1个点就取一个数据点，其他位置取零，就可以形成一个新序列，我们称其为抽取。抽取后信号的间隔提高了M倍，速率也就降了下来。抽取具有线性时变（周期时不变）的特点。

下采样一般分为两个步骤

1. 离散采样（抽取）
2. 信号压缩（将0去除）

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/downI.jpg)

分析是不会分析的，这辈子都不会分析的。

最终在频谱上的反应是

1. 下采样后的频谱幅度缩小为1/M
2. 下采样后的频谱时原始频谱的M倍扩展
3. 周期仍然是$$2\pi$$

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/ori.jpg)

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/after.jpg)

看起来带宽展宽了，实际上并不是。这里是归一化频率。实际上带宽不会有任何变化。

想想也是，虽然是采样，但是也只是对信号进行采样而已，信号又不会失真。

下采样有可能产生频谱的混叠。当时域间隔过大的时候，频域间隔就会越来越小直至出现混叠，这就会失真了。不发生混叠的条件是

$$\omega_x \leq \pi/M$$

理解不了看图

混叠的后果

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/Aliasing.jpg)



为了防止出现频谱混叠，因此在下采样过程中药增加一个滤波器，将信号带限至$$\pi/M$$

实际上并不是对信号频域做截断，而是在满足采样速率的条件下，将信号有效区域外的噪声滤除。完整的抽取器如图

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/DownScale.png)

抗混叠滤波器一般是低通滤波器，信号也一般是满足带限要求的，抗混叠滤波器的作用一般就是抑制混叠噪声。

#### 上采样（升速率）

上采样就是将信号速率升为原始速率的L倍，我们一般称过程其为内插。内插是在两个采样点之间插入（L-1）个数据点，以形成一个新的序列。内插时一般采用内插0的操作，然后使用低通滤波器就能获取上采样信号。

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/UpScale.jpg)

上采样同样具有线性（叠加性与均匀性），同样不满足时不变性。经过计算可以得到，上采样的频谱时原始频谱的L倍压缩。

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/USI.jpg)

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/USII.jpg)

上采样前后带宽也是没有改变的，记住原则是信号无失真。但是上采样的抽取过程会产生镜像频率。注意看上面的图，我们可以看见在$$2\pi$$范围内多出来了一组频谱，我们需要抑制这个频谱（对于L倍上采样，会多出（L-1）组），因此需要设计滤波器。

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/UpScale.png)

完整的内插器会在上采样后增加一个抗镜频滤波器，利用低通滤波除去（L-1）组高频镜像。当然实际上抗镜像滤波器可以设计为带通滤波器，这样就能实现上变频。抗镜像滤波器设计需要在保证信号带宽的基础上尽量抑制镜像频率。

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/FullUpScale.jpg)

可以看出内插的0变成了准确值，信号没有产生失真，而且提高了时域分辨率。

#### 分数倍采样率转换

通过抽取实现M倍下采样、通过内插实现L倍上采样，级联内插器和抽取器就可以实现分数倍采样速率转换。

抽取和内插的顺序是可以调换的，原则是计算次数最少。而且考虑到内插器与抽取器的滤波器位置，经常将信号先内插后抽取，实现滤波器的复用（但是效率并非最高）。以上都需要在满足信号无失真的条件下进行。

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/expI.png)

其中等效滤波器的截止频率应当取两者截止频率的最小值。

### 多级系统

实际应用中很难一次操作完成较大倍数的采样率转换（较大倍数的抽取或内插需要很窄通带的滤波器，实现此类滤波器需要很高的阶数，实现难度高），因此常采用多级系统。数字信号的处理中噪声不会每级累积，而是在抽样判决后消除，因此多级系统不会像模拟电路那样产生积累噪声。

将抽取或内插的倍数分解为多个小整数的乘积，再进行多级系统拆分，如果首先对信号进行多级内插再对信号进行多级抽取，中间的滤波器还是可以等效为一个滤波器。

多级系统的目的是增加滤波器的可实现性，但是由于多级滤波器的带内波动会累加，因此设计时需要严格控制带内平坦度为单级实现的K倍（K=ML）

### 变速率DSP过程中的数字滤波器设计

滤波器设计思想

1. 使信号失真最小
2. 降低复杂度，实现结构简单，满足实时性要求（低延迟）

滤波器中存在六个恒等关系

1. 多路信号先叠加后抽取可以等效为先抽取后叠加。
2. 信号先延迟M后M倍抽取等效为先M倍抽取后延迟1
3. 信号先经过滤波器$$H(z^M)$$后M倍抽取等效为先M倍抽取后通过滤波器$$H(z)$$
4. 信号先内插L倍后分路等效为先分路后（分别）内插
5. 信号先延迟1后内插可以等效为L倍内插后延迟L
6. 信号先经过滤波器$$H(z)$$后内插L等效为先内插L后经过滤波器$$H(z^L)$$

FIR滤波器有良好的线性相位特性，而IIR滤波器实现更为简单（相位狗屎）。

在DSP中如果我们希望信号不出现群时延（失真），那就需要采用线性相位的滤波器，即FIR滤波器。如果我们对相位不敏感就可以采用IIR滤波器。

#### FIR抽取器直接实现结构

常见的数字滤波器实现的结构（直接型）实现如下

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/direct.jpg)

信号输入后，对信号进行多级延迟后乘一个增益就相当于卷积操作，这个过程就是滤波。滤波后进行下采样，获得降速率的信号。根据恒等关系，该结构相当于先对数据进行降采样然后滤波，此时滤波器进行的运算次数（主要是乘法）就大大减小。乘法在运算中复杂度远高于加法，因此该操作可以显著降低运算的复杂度，提高处理的实时性。但是需要更多的抽取器，典型的花钱买效率的操作。这个实现我们称为**高效实现结构**，因为乘法的运算次数降低为$$1/M$$次，若滤波器系数对称，甚至可以再降低一半的乘法次数。

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/HE.jpg)

如图即为偶数阶系数对称的FIR抽取器的高效结构。加法运算复杂度远比乘法小（乘法的计算时钟大约比加法多100倍）

#### FIR内插器直接实现结构

内插时要先进行内插后进行滤波抑制镜频。内插是抽取的反操作，只要我们将上一个结构完全颠倒就得到了内插器的结构。

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/UP.jpg)

容易知道内插0值时不用乘法运算，因此我们的乘法操作可以在内插前执行，根据恒等关系我们可以将内插放在乘法后，类似上面实现的原理。此时计算乘法次数降低为$$1/L $$系数对称时还可以再降低一半。

#### FIR抽取与内插滤波器的多相实现

经过高效处理后，系统的复杂度仍然很高，还有优化的余地。我们仔细观察就会发现，滤波器都工作在高频率端口，即内插后，抽取前。这就给滤波器设计带来了负担。因此引出滤波器的多相实现方法，使滤波器工作在低速率截断，降低处理速度的需求。

高阶FIR滤波器可以由基于多相分解的并行结构来实现，FIR滤波器的传输函数被分解为M个低阶传输函数的方法叫做多相分解方法。这M个低阶传输函数的和就等效为原始传输函数。

FIR滤波器的传输函数可以写作

$$H(z)=\sum\limits_{n=0}^{N-1}h(n)z^{-n}$$

将该式按照偶次系数和奇次系数分为两部分，考虑到一般性，我们假定阶数N为奇数，表达式可以分组为

$$H(z)=\sum\limits_{n \in 奇数}^{N-1}h(n)z^{-n}+\sum\limits_{n \in 偶数}^{N-1}h(n)z^{-n}$$

将奇数和项提出一个$$z^{-1}$$，原式可以写为

$$H(z)=h(0)+h(2)z^{-2}+...+h(N-1)z^{-(N-1)}+z^{-1}[h(1)+h(3)^{z^{-2}}+...+h(N-2)z^{-(N-3)}]$$

我们可以定义多相分量为

$$E_0(z)=h(0)+h(2)z^{-1}+...+h(N-1)z^{-(N-1)/2}$$

$$E_1(z)=h(1)+h(3)z^{-1}+...+h(N-2)z^{-(N-3)/2}$$

就可以将传递函数表示为

$$H(z)=E_0(z^2)+z^-1E_1(z^2)$$

这只是分为两组。如果我们尝试将滤波器系数分为M组，就将得到

$$H(z)=\sum\limits_{K=0}^{M-1}\sum\limits_{n=-\infty}^{\infty}h(nM+K)z^{-(nM+K)}=\sum\limits_{k=0}^{M-1}z^{-k}E_k(z^M)$$

当无法整除时，各组向下取整，且各个组的$$h(n)$$个数可以不相等。

如此可将滤波器分解为并行的M个多相分量，并在输出端叠加。这样的多相分量有时也被称为多相子滤波器。M倍抽取滤波器分解为M个多相分支，再利用恒等关系，可以将滤波器安排在低速率端。此时实时性是变差的。

另外每一个多相支路的数序列可以表示为序列的延时+抽取，可以设计一个旋转器，实现如图的处理

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/re.png)

对于内插器有同样的原理，结构也与这个相似

![ADSP](https://raw.githubusercontent.com/psycholsc/psycholsc.github.io/master/assets/reII.png)

衡量变速率系统的高效性的一个常用统计量是**每秒钟需要运算乘法的次数**。

多相滤波的有点在于降低了运算复杂度，并降低了滤波器阶数。



FIR计算复杂度

**抽取器**

直接型$$R_{M\_DEC}=Nf_x$$

多相型$$R_{M\_DEC}=\frac{Nf_x}{M}$$

**内插器**

直接型$$R_{M\_INT}=LNf_x$$

多相型$$R_{M\_INT}=Nf_x$$





### IIR抽取内插滤波器的直接实现结构

IIR滤波器前面就说过，阶数比FIR低很多，相同性能下运算量很少。FIR滤波器经过以上的各种操作后仍然要比IIR效率低，但是IIR相位非线性，还对量化噪声敏感。

算了看了一遍发现我并不会。记几个公式算了

IIR计算复杂度

**抽取器**

直接型$$R_{M\_DEC}=Nf_x+\frac{(N+1)f_x}{M}=\frac{MN+(N+1)}{M}f_x$$

多相型$$R_{M\_DEC}=\frac{Nf_x}{M}$$

**内插器**

直接型$$R_{M\_INT}=(N+1)f_x+LNf_x=[LN+(N+1)]f_x$$

多相型$$R_{M\_INT}=Nf_x$$

### 典型高速数字滤波器

在实时性要求很高的时候，往往采用特殊滤波器。







